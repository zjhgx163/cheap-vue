"use strict";(self["webpackChunkcheap_quasar"]=self["webpackChunkcheap_quasar"]||[]).push([[804],{6328:function(e,a,t){t.r(a),t.d(a,{default:function(){return b}});var n=t(59835),r=t(86970),o={class:"column flex-center bg-primary"},i={class:"col-sm-4 row flex-center"},l={class:"text-grey-9 text-weight-bold text-subtitle2",style:{"text-decoration":"underline"}},s=["src"],u={class:"YL__750w bg-secondary"};function d(e,a,t,d,c,g){var f=(0,n.up)("q-toolbar-title"),m=(0,n.up)("q-btn"),h=(0,n.up)("q-avatar"),w=(0,n.up)("q-toolbar"),v=(0,n.up)("q-header"),p=(0,n.up)("router-view"),q=(0,n.up)("q-page-container"),L=(0,n.up)("login-qr"),C=(0,n.up)("q-layout");return(0,n.wg)(),(0,n.j4)(C,null,{default:(0,n.w5)((function(){return[(0,n._)("div",o,[(0,n.Wm)(v,{elevated:"",class:"YL__750w bg-pink-4"},{default:(0,n.w5)((function(){return[(0,n.Wm)(w,null,{default:(0,n.w5)((function(){return[(0,n.Wm)(f,{inset:"",class:"q-ml-md"},{default:(0,n.w5)((function(){return[(0,n.Uk)("生活频道")]})),_:1}),(0,n._)("div",i,[(0,n.Wm)(m,{unelevated:"",flat:""},{default:(0,n.w5)((function(){return[(0,n._)("a",l,(0,r.zw)(c.userName),1)]})),_:1}),(0,n.Wm)(h,{size:"2.5em"},{default:(0,n.w5)((function(){return[(0,n._)("img",{src:c.avatar},null,8,s)]})),_:1})])]})),_:1})]})),_:1}),(0,n._)("div",u,[(0,n.Wm)(q,null,{default:(0,n.w5)((function(){return[(0,n.Wm)(p,{userInfo:c.userInfo,onNeedLogin:g.needLogin},null,8,["userInfo","onNeedLogin"])]})),_:1})])]),(0,n.Wm)(L,{"is-loading-qr":c.isLoadingQr,onLoginCardChanged:g.loginCardChange,"login-card":c.loginCard,"wechat-qr":c.wechatQr,"is-persistent":!1},null,8,["is-loading-qr","onLoginCardChanged","login-card","wechat-qr"])]})),_:1})}t(52519),t(69665);var c=t(86204),g=t(17779),f={components:{LoginQr:c.Z},name:"CouponLayout",data:function(){return{avatar:"/static/not_login_user.png",userName:"注册/登陆",isLogin:!1,userInfo:{},isLoadingQr:!1,loginCard:!1,wechatQr:"",timer:null}},mounted:function(){g.log("CouponLayout mounted");var e=window.screen.width;if(e>1023.99&&(this.isBigScreen=!0),this.$q.localStorage.has("userInfo")){var a=this.$q.localStorage.getItem("userInfo");g.log("userInfo",a),void 0!==a&&null!==a&&(this.userInfo=a,this.userName=a.nickname,this.isLogin=!0,null!=a.headimgurl&&""!=a.headimgurl&&(this.avatar=a.headimgurl))}},created:function(){g.log("CouponLayout created")},methods:{loginCardChange:function(e){this.loginCard=e,this.isLoadingQr=!1,this.wechatQr="",clearInterval(this.timer)},needLogin:function(){var e=this,a=this.$q.localStorage.getItem("userInfo");void 0!==a&&null!==a&&this.$q.localStorage.remove("userInfo"),this.isLoadingQr=!0,this.loginCard=!0,this.$axios.post("".concat(t.g.config.domain,"/wechat/createQr"),{}).then((function(a){if(e.isLoadingQr=!1,0==a.data.code){e.wechatQr=a.data.data.qrUrl;var n=new Date;clearInterval(e.timer),e.timer=window.setInterval((function(){e.$axios.post("".concat(t.g.config.domain,"/user/getScanLoginInfo/").concat(a.data.data.sceneStr),{}).then((function(a){if(0==a.data.code)if(g.log("this.timer = "+e.timer),a.data.data.loginFlag)e.userName=a.data.data.nickname,e.avatar=a.data.data.avatar,e.userInfo=a.data.data,e.isLogin=!0,e.$q.localStorage.set("userInfo",a.data.data),window.clearInterval(e.timer),e.loginCard=!1;else{var t=new Date;t.getTime()-n.getTime()>6e5&&(g.log("二维码过期"),window.clearInterval(e.timer),e.$q.notify({type:"negative",message:"二维码已过期，2秒后跳转页面"}),setTimeout((function(){e.$router.push({path:"/"})}),2e3))}else e.$q.notify({type:"negative",message:a.data.msg}),g.log("that.timer = "+e.timer),window.clearInterval(e.timer),e.loginCard=!1}))}),1e3)}else e.$q.notify({type:"negative",message:a.data.msg}),e.loginCard=!1}))}}},m=t(11639),h=t(20249),w=t(16602),v=t(51663),p=t(81973),q=t(68879),L=t(61357),C=t(12133),I=t(10906),_=t(69984),Q=t.n(_);const y=(0,m.Z)(f,[["render",d]]);var b=y;Q()(f,"components",{QLayout:h.Z,QHeader:w.Z,QToolbar:v.Z,QToolbarTitle:p.Z,QBtn:q.Z,QAvatar:L.Z,QPageContainer:C.Z,QDrawer:I.Z})}}]);